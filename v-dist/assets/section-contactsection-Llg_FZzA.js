var D=Object.defineProperty;var P=(h,n,r)=>n in h?D(h,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[n]=r;var E=(h,n,r)=>P(h,typeof n!="symbol"?n+"":n,r);import{d as V,H as L,r as g,I as Z,c as $,z as K,A as G,B as Y,w as H,a as p,o as d,J as Q,b as u,k as q,h as j,s as W,F as ee,i as te,G as se,j as C,u as X,t as F,K as re}from"./vendor-vue-core-Da35iIbE.js";import{a as ae}from"./page-calculatorpage-BvWRwaQl.js";import"./vendor-other-M6hoS51G.js";import"./vendor-unhead-Ctj13N-t.js";import"./vendor-vue-router-VH5bjaC2.js";import"./vendor-pinia-Diq2_CCV.js";class R{static async submitForm(n){try{const r={...n},m=globalThis.SUPABASE_ANON||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkZXZmY2h2YmpnZGFsenlxYnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MTc1MjUsImV4cCI6MjA3NzI5MzUyNX0.mz0KaUSQhBNSTlkj-y5ZKGlOyefvduOwkbo1jXOiopI",x=this.baseURL.includes("supabase.co/functions"),o={"Content-Type":"application/json"};x&&m&&(o.Authorization=`Bearer ${m}`,o.apikey=m);const i=await fetch(`${this.baseURL}/contact-form`,{method:"POST",headers:o,body:JSON.stringify(r)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const c=await i.json();if(!c.success)throw new Error(c.message||"Ошибка при отправке формы");return{success:!0,message:c.message||"Заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",clientId:c.clientId}}catch(r){return r instanceof Error?{success:!1,message:r.message}:{success:!1,message:"Произошла ошибка при отправке формы. Попробуйте еще раз."}}}static async validateForm(n){try{const r=await fetch(`${this.baseURL}/contact-form/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch{return{valid:!1,errors:{general:"Ошибка валидации"}}}}static async getFormById(n){try{const r=await fetch(`${this.baseURL}/contact-form/${n}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const m=await r.json();if(!m.success)throw new Error(m.message||"Ошибка при получении заявки");return{success:!0,message:"Заявка получена",data:m.data}}catch(r){return r instanceof Error?{success:!1,message:r.message}:{success:!1,message:"Ошибка при получении заявки"}}}}E(R,"baseURL",globalThis.API_BASE||"https://udecfvhvbjgdalzyqbph.supabase.co/functions/v1");const oe={key:0,class:"flex items-center justify-center py-20"},ne=["value"],ie={class:"flex flex-col sm:flex-row gap-4 justify-center items-stretch sm:items-start"},le=["type","value","onInput","placeholder","aria-invalid","aria-describedby"],ce=["id"],ue={class:"flex justify-center bg-accent rounded-[3rem] hover:bg-purple transition-colors duration-200 w-full sm:w-auto"},me=["disabled","aria-busy"],pe={key:0},de={key:1},fe={key:0,class:"text-red-500 text-sm text-center",role:"alert","aria-live":"polite"},ve=V({__name:"ContactSection",setup(h){const n=L({renderStart:0,renderEnd:0,validationTime:0,inputDebounceTime:0}),r=new Map,m=(t,e)=>{let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>t(...a),e)}},x=(t,e)=>{let s=0;return(...a)=>{const l=Date.now();l-s>=e&&(s=l,t(...a))}},o=g({name:"",phone:"",email:"",honeypot:"",formStartedAt:Date.now()}),i=g({}),c=g(!1),w=g(!1),k=g(null);let f=null;const A=Z([{key:"name",placeholder:"Ваше имя",type:"text"},{key:"phone",placeholder:"Телефон (+7 XXX XXX-XX-XX)",type:"tel"},{key:"email",placeholder:"Электронная почта",type:"email"}]),M=$(()=>"w-full max-w-xs px-4 sm:px-5 md:px-6 py-3 sm:py-3.5 md:py-4 text-sm sm:text-base border border-bg rounded-[3rem] text-bg placeholder:text-bg/70 bg-transparent focus:outline-none focus:border-accent focus:ring-0 transition-colors duration-200"),N=$(()=>"w-full sm:w-auto px-6 sm:px-7 md:px-8 py-3 sm:py-3.5 md:py-4 text-sm sm:text-base border border-bg rounded-[3rem] text-bg bg-transparent hover:bg-bg hover:text-text transition-colors duration-200 focus:outline-none focus:border-accent focus:ring-0 disabled:opacity-50 disabled:cursor-not-allowed"),I=t=>{const e=`name-${t}`;if(r.has(e))return r.get(e);const s=performance.now();let a;return t.trim()?t.trim().length<2?a="Имя должно содержать минимум 2 символа":a=void 0:a="Имя обязательно для заполнения",r.set(e,a),n.validationTime+=performance.now()-s,a},_=t=>{const e=`phone-${t}`;if(r.has(e))return r.get(e);const s=performance.now();let a;return t.trim()?a=/^[\+]?[0-9\s\-\(\)]{10,}$/.test(t)?void 0:"Введите корректный номер телефона":a="Телефон обязателен для заполнения",r.set(e,a),n.validationTime+=performance.now()-s,a},T=t=>{const e=`email-${t}`;if(r.has(e))return r.get(e);const s=performance.now();let a;return t.trim()?a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?void 0:"Введите корректный email адрес":a="Email обязателен для заполнения",r.set(e,a),n.validationTime+=performance.now()-s,a},O=m(((t,e)=>{const s=performance.now();let a;switch(t){case"name":a=I(e);break;case"phone":a=_(e);break;case"email":a=T(e);break}a?i.value[t]=a:delete i.value[t],n.inputDebounceTime+=performance.now()-s}),300),z=x(((t,e)=>{const s=e.target;let a=s.value;if(t==="phone"){const l=a.replace(/\D/g,"");let v=l;if(l.startsWith("8")&&l.length>=1&&(v="7"+l.slice(1)),v.length>=1){const y=v.padEnd(11,"");a=`+${y[0]||""} ${y.slice(1,4).trim()} ${y.slice(4,7).trim()}-${y.slice(7,9).trim()}-${y.slice(9,11).trim()}`.trim().replace(/\s+/g," ").trim()}}o.value[t]=a,i.value[t]&&delete i.value[t],O(t,s.value)}),16),U=()=>{const t=performance.now(),e={},s=I(o.value.name);s&&(e.name=s);const a=_(o.value.phone);a&&(e.phone=a);const l=T(o.value.email);return l&&(e.email=l),i.value=e,n.validationTime+=performance.now()-t,Object.keys(e).length===0},B=async()=>{if(performance.now(),!U()){i.value.general="Пожалуйста, исправьте ошибки в форме";return}c.value=!0,i.value.general=void 0;try{performance.now();const t=await R.submitForm({name:String(o.value.name),phone:String(o.value.phone),email:String(o.value.email),honeypot:String(o.value.honeypot),formStartedAt:Number(o.value.formStartedAt)});performance.now(),t.success?(o.value.name="",o.value.phone="",o.value.email="",i.value={},r.clear(),alert(t.message||"Заявка успешно отправлена!")):i.value.general=t.message||"Произошла ошибка при отправке заявки. Попробуйте еще раз."}catch{i.value.general="Произошла ошибка при отправке заявки. Попробуйте еще раз."}finally{c.value=!1}};K(()=>{n.renderStart=performance.now(),o.value.formStartedAt=Date.now(),G(()=>{n.renderEnd=performance.now()}),k.value&&(f=new IntersectionObserver(([t])=>{t&&t.isIntersecting&&(w.value=!0,f&&(f.disconnect(),f=null))},{rootMargin:"100px",threshold:.1}),f.observe(k.value))}),Y(()=>{f&&(f.disconnect(),f=null),r.clear()}),H(()=>{r.size>100&&r.clear()});const b=t=>{var e;return(e=i.value)==null?void 0:e[String(t)]};return(t,e)=>(d(),p("section",{ref_key:"sectionRef",ref:k,class:"no-scrollbar bg-text px-4 sm:px-6 md:px-8 lg:px-12 xl:px-[12rem] py-4 sm:py-6 md:py-8 lg:py-[2rem] overflow-y-auto",style:{"min-height":"600px","box-sizing":"border-box",contain:"layout style paint"}},[w.value?Q([w.value,c.value],()=>(d(),p("div",{key:1,class:"flex flex-col border border-accent rounded-[3rem] p-4 sm:p-5 md:p-6"},[e[5]||(e[5]=u("h3",{class:"text-bg text-xl sm:text-2xl md:text-3xl font-bold text-center mb-3 sm:mb-4"}," Станьте нашим новым партнером ",-1)),e[6]||(e[6]=u("p",{class:"text-bg text-xs sm:text-sm text-center mb-6 sm:mb-8 px-2"}," Оставьте заявку на сотрудничество прямо сейчас и получите стоимость проекта уже сегодня ",-1)),u("form",{onSubmit:re(B,["prevent"]),class:"space-y-6"},[q(u("input",{type:"text",autocomplete:"off","aria-hidden":"true",style:{position:"absolute",left:"-9999px",opacity:"0"},"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.honeypot=s)},null,512),[[W,o.value.honeypot]]),u("input",{type:"hidden",value:o.value.formStartedAt},null,8,ne),u("div",ie,[(d(!0),p(ee,null,te(X(A),(s,a,l,v)=>{const y=[o.value[s.key],b(s.key)??""];if(v&&v.key===s.key&&se(v,y))return v;const S=(d(),p("div",{key:s.key,class:"flex flex-col w-full sm:w-auto"},[u("input",{type:s.type,value:o.value[s.key],onInput:J=>X(z)(s.key,J),placeholder:s.placeholder,class:C(M.value),"aria-invalid":!!b(s.key),"aria-describedby":b(s.key)?`${s.key}-error`:void 0},null,42,le),b(s.key)?(d(),p("p",{key:0,id:`${s.key}-error`,class:"text-red-500 text-xs mt-1 text-center",role:"alert"},F(b(s.key)),9,ce)):j("",!0)]));return S.memo=y,S},e,1),128)),u("div",ue,[u("button",{type:"submit",class:C(N.value),disabled:c.value,"aria-busy":c.value},[c.value?(d(),p("span",pe,"Отправка...")):(d(),p("span",de,"Отправить"))],10,me)])]),i.value.general?(d(),p("p",fe,F(i.value.general),1)):j("",!0)],32)])),e,3):(d(),p("div",oe,[...e[4]||(e[4]=[u("div",{class:"animate-spin w-8 h-8 border-2 border-accent border-t-transparent rounded-full will-change-transform"},null,-1)])]))],512))}}),Se=ae(ve,[["__scopeId","data-v-c4013118"]]);export{Se as default};
