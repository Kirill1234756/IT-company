var O=Object.defineProperty;var $=(p,e,o)=>e in p?O(p,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):p[e]=o;var A=(p,e,o)=>$(p,typeof e!="symbol"?e+"":e,o);import{a as z,u as B}from"./vendor-vue-router-VH5bjaC2.js";import{u as E}from"./page-servicespage-CcXjCdwV.js";import{r as T,V as J,d as M,w as P,c as R,a as y,o as f,b as s,K as Z,k as U,u as r,F as V,i as C,h as S,m as w,t as I,p as L,l as Y,s as q,q as G}from"./vendor-vue-core-Da35iIbE.js";import{F as H}from"./section-formsection-DLA7lWAJ.js";import{u as K,a as W}from"./page-calculatorpage-BvWRwaQl.js";import"./vendor-tailwind-C6Cmh_M-.js";import"./vendor-other-M6hoS51G.js";import"./vendor-unhead-Ctj13N-t.js";import"./vendor-pinia-Diq2_CCV.js";class X{static async submitForm(e){try{const o={companyDescription:e.companyDescription,task:e.task,solutionVision:e.solutionVision,expectations:e.expectations,budget:e.budget,name:e.name,company:e.company,phone:e.phone,email:e.email,privacyAccepted:e.privacyAccepted??!0,honeypot:e.honeypot,formStartedAt:e.formStartedAt},t=e;t.attachedFileUrl&&(o.attachedFileUrl=t.attachedFileUrl,o.attachedFileName=t.attachedFileName,o.attachedFileSize=t.attachedFileSize);const l=globalThis.SUPABASE_ANON||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkZXZmY2h2YmpnZGFsenlxYnBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MTc1MjUsImV4cCI6MjA3NzI5MzUyNX0.mz0KaUSQhBNSTlkj-y5ZKGlOyefvduOwkbo1jXOiopI",u=this.baseURL.includes("supabase.co/functions"),h={"Content-Type":"application/json"};u&&l&&(h.Authorization=`Bearer ${l}`,h.apikey=l);const x=await fetch(`${this.baseURL}/client-form`,{method:"POST",headers:h,body:JSON.stringify(o)});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const b=await x.json();if(!b.success)throw new Error(b.message||"Ошибка при отправке формы");return{success:!0,message:b.message||"Заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",clientId:b.clientId}}catch(o){return o instanceof Error?{success:!1,message:o.message}:{success:!1,message:"Произошла ошибка при отправке формы. Попробуйте еще раз."}}}static async validateForm(e){try{const o=await fetch(`${this.baseURL}/client-form/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch{return{valid:!1,errors:{general:"Ошибка валидации"}}}}}A(X,"baseURL",globalThis.API_BASE||"https://udecfvhvbjgdalzyqbph.supabase.co/functions/v1");function D(){const p=T(!1),e=T({}),{trackFormSubmit:o}=E(),t=J({companyDescription:"",task:"",solutionVision:"",expectations:"",budget:"",name:"",company:"",phone:"",email:"",attachedFile:null,privacyAccepted:!1,honeypot:"",formStartedAt:Date.now()}),l=d=>{const i=d.target;if(i.files&&i.files[0]){const c=i.files[0];if(c.size>20*1024*1024){e.value.file="Максимум 20 МБ";return}t.attachedFile=c,e.value.file=""}},u=d=>{const i=d.replace(/\D/g,"");if(!i)return"";let c=i;return i.startsWith("8")&&i.length===11?c="7"+i.slice(1):i.length===10?c="7"+i:i.startsWith("7")&&i.length===11&&(c=i),c.length===11?`+${c}`:d},h=()=>{e.value={},["companyDescription","task","solutionVision","expectations","budget","name","company","phone","email"].forEach(k=>{t[k].trim()||(e.value[k]="Обязательное поле")});const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;t.email&&!i.test(t.email)&&(e.value.email="Некорректный email"),t.phone&&(t.phone=u(t.phone));const c=/^\+?[0-9]{11,15}$/;return t.phone&&!c.test((t.phone.replace(/\D/g,"").length===11,t.phone))&&(e.value.phone="Некорректный номер телефона"),t.privacyAccepted||(e.value.privacy="Необходимо принять политику конфиденциальности"),Object.keys(e.value).length===0};return{formData:t,errors:e,isSubmitting:p,handleFileUpload:l,validateForm:h,submitForm:async()=>{if(!h())return{success:!1,message:"Пожалуйста, исправьте ошибки в форме"};p.value=!0;try{const d=await X.submitForm(t);return d.success&&o("client-form",{budget:t.budget,company:t.company,has_file:t.attachedFile?"yes":"no"}),d}catch{return{success:!1,message:"Произошла ошибка при отправке формы. Попробуйте еще раз."}}finally{p.value=!1}},resetForm:()=>{Object.assign(t,{companyDescription:"",task:"",solutionVision:"",expectations:"",budget:"",name:"",company:"",phone:"",email:"",attachedFile:null,privacyAccepted:!1}),e.value={}}}}const Q={class:"min-h-screen bg-text"},ee={class:"mx-auto px-5 md:px-[5rem] py-[5rem]"},te=["value"],se={class:"bg-text border border-bg rounded-[3rem] p-6 shadow-sm mt-8"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ae=["value","onInput","placeholder"],ie={key:0,class:"client-form-error text-sm mt-2"},ne={class:"mb-6"},re={key:0,class:"client-form-error text-sm mt-2"},le={class:"text-center"},ce={class:"mb-8"},pe={class:"flex items-center justify-center gap-3 text-sm client-form-text"},ue={key:0,class:"client-form-error text-sm mt-2"},de=["disabled"],me={key:0},he={key:1},fe=M({__name:"ClientFormPage",setup(p){const e=z(),o=B(),{schema:t}=K(o);P(()=>{t.value&&L({script:[{type:"application/ld+json",children:JSON.stringify(t.value),key:"breadcrumb-schema"}]})});const{formData:l,errors:u,isSubmitting:h,submitForm:x}=D(),b=T(),d=[{key:"name",placeholder:"Имя (как к вам обращаться)"},{key:"company",placeholder:"Компания (если есть)"},{key:"phone",placeholder:"Телефон (+7 XXX XXX-XX-XX, можно начать с 8)"},{key:"email",placeholder:"Электронная почта"}],i=(m,n)=>{let g=n.target.value;if(m==="phone"){const F=g.replace(/\D/g,"");let _=F;if(F.startsWith("8")&&F.length>=1&&(_="7"+F.slice(1)),_.length>=1){const v=_;g=(v.length>=11?`+${v[0]} ${v.slice(1,4)} ${v.slice(4,7)}-${v.slice(7,9)}-${v.slice(9,11)}`:`+${v}`).replace(/\s+/g," ").trim()}}l[m]=g},c=()=>{var m;(m=b.value)==null||m.click()},k=async()=>{const m=await x();alert(m.message),m.success&&e.push("/")},j=R(()=>[{title:"Что вы делаете?",helperText:"Расскажите о вашей компании. Как вы работаете, сколько зарабатываете? Кто ваши конкуренты? Чем вы от них отличаетесь?",field:"companyDescription",variant:"white"},{title:"Какова ваша задача?",helperText:"Чего вы хотите достичь в ближайшем будущем? Что вам мешает?",field:"task",variant:"blue"},{title:"Как вы видите решение проблемы?",helperText:"В какой форме вы хотите увидеть решение своей проблемы? Когда? Почему это важно? Как это должно выглядеть?",field:"solutionVision",variant:"white"},{title:"Каковы ваши ожидания от результата?",helperText:"Чего вы хотите достичь в ближайшем будущем? Что вам мешает?",field:"expectations",variant:"blue"},{title:"Сколько денег вы планируете потратить?",helperText:"Какой у вас бюджет? Почему вы готовы потратить такую сумму?",field:"budget",variant:"white"}]),N=(m,n)=>{l[m]=n};return(m,n)=>(f(),y("div",Q,[s("div",ee,[n[6]||(n[6]=s("div",{class:"text-center mb-16"},[s("h1",{class:"text-3xl md:text-5xl font-bold text-accent mb-6 font-display"},"Стать клиентом"),s("p",{class:"text-lg client-form-text max-w-3xl mx-auto leading-relaxed"}," Ответьте на пару вопросов. На основе ответов мы поймем, как можем быть полезны, соберем информацию и подготовимся к встрече. Если не сможем помочь — порекомендуем подходящих партнеров. Приоритетно отвечаем на email, считаем ответы лучшей заявкой. ")],-1)),s("form",{onSubmit:Z(k,["prevent"]),class:"space-y-8"},[U(s("input",{type:"text",autocomplete:"off","aria-hidden":"true",style:{position:"absolute",left:"-9999px",opacity:"0"},"onUpdate:modelValue":n[0]||(n[0]=a=>r(l).honeypot=a)},null,512),[[q,r(l).honeypot]]),s("input",{type:"hidden",value:r(l).formStartedAt},null,8,te),(f(!0),y(V,null,C(j.value,a=>(f(),Y(H,{key:a.field,title:a.title,"helper-text":a.helperText,variant:a.variant,"model-value":String(r(l)[a.field]||""),error:r(u)[a.field],"onUpdate:modelValue":g=>N(a.field,g)},null,8,["title","helper-text","variant","model-value","error","onUpdate:modelValue"]))),128)),s("div",se,[n[4]||(n[4]=s("h2",{class:"text-3xl font-bold text-accent text-center mb-8 font-display"}," И последняя информация ",-1)),s("div",oe,[(f(),y(V,null,C(d,a=>s("div",{key:a.key},[s("input",{value:r(l)[a.key],onInput:g=>i(a.key,g),placeholder:a.placeholder,class:"w-full px-4 placeholder:text-bg py-3 client-form-input rounded-[3rem] text-sm focus:outline-none"},null,40,ae),r(u)[a.key]?(f(),y("p",ie,I(r(u)[a.key]),1)):S("",!0)])),64))]),s("div",ne,[s("button",{type:"button",onClick:c,class:"inline-flex items-center px-6 py-3 !bg-accent rounded-[3rem] focus:outline-none"},[...n[2]||(n[2]=[s("span",{class:"text-lg mr-2"},"+",-1),w(" Attach file ",-1)])]),n[3]||(n[3]=s("p",{class:"client-form-helper mt-2"},"Максимум 20 МБ",-1)),r(u).file?(f(),y("p",re,I(r(u).file),1)):S("",!0)])]),s("div",le,[s("div",ce,[s("label",pe,[U(s("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=a=>r(l).privacyAccepted=a),class:"w-4 h-4 client-form-checkbox border-border rounded focus:ring-accent"},null,512),[[G,r(l).privacyAccepted]]),n[5]||(n[5]=s("span",null,[w(" Нажимая кнопку «Отправить», вы принимаете "),s("a",{href:"#",class:"client-form-link hover:underline"},"Политику конфиденциальности"),w(". ")],-1))]),r(u).privacy?(f(),y("p",ue,I(r(u).privacy),1)):S("",!0)]),s("button",{type:"submit",class:"!bg-accent hover:bg-purple px-8 py-3 rounded-[3rem] text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:r(h),"aria-label":"Отправить форму"},[r(h)?(f(),y("span",me,"Отправка...")):(f(),y("span",he,"Отправить ответы"))],8,de)])],32)])]))}}),Te=W(fe,[["__scopeId","data-v-0829d79c"]]);export{Te as default};
