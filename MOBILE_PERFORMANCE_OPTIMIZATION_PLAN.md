# План оптимизации производительности для мобильных устройств

## Текущие показатели (мобильные устройства)

- **Performance Score**: 47/100 ❌
- **LCP**: 9.8 сек (цель: < 2.5 сек) ❌
- **CLS**: 0.965 (цель: < 0.1) ❌
- **FCP**: 2.6 сек (цель: < 1.8 сек) ❌
- **TBT**: 0 мс ✅
- **SI**: 2.6 сек ✅

## Критические проблемы

### 1. LCP (Largest Contentful Paint) - 9.8 сек ❌

**Проблемы:**

- Изображения не оптимизированы для мобильных устройств
- Нет responsive images (srcset)
- Отсутствует приоритизация загрузки LCP элемента
- Шрифты могут блокировать рендеринг
- GSAP анимации загружаются слишком рано

**Решения:**

#### 1.1 Оптимизация изображений

- [ ] Добавить `srcset` для всех изображений с разными размерами для мобильных/десктоп
- [ ] Конвертировать изображения в WebP/AVIF формат
- [ ] Использовать `loading="eager"` только для LCP изображения
- [ ] Добавить `fetchpriority="high"` для LCP изображения
- [ ] Использовать `decoding="async"` для всех изображений

#### 1.2 Оптимизация шрифтов

- [ ] Использовать `font-display: optional` (уже есть, проверить)
- [ ] Preload только критических шрифтов
- [ ] Использовать `size-adjust` для fallback шрифтов
- [ ] Рассмотреть использование системных шрифтов на мобильных

#### 1.3 Оптимизация LCP элемента

- [ ] Убедиться, что h1 в MainSection является LCP элементом
- [ ] Preload критических ресурсов для LCP
- [ ] Минимизировать CSS для above-the-fold контента
- [ ] Отложить загрузку GSAP до после LCP (уже есть, но проверить таймауты)

### 2. CLS (Cumulative Layout Shift) - 0.965 ❌

**Проблемы:**

- Много `will-change` свойств, которые могут вызывать layout shifts
- Изображения без точных размеров или aspect-ratio
- Анимации могут вызывать shifts
- Шрифты могут вызывать shifts при загрузке
- Динамический контент без резервирования места

**Решения:**

#### 2.1 Убрать/оптимизировать will-change

- [ ] Убрать `will-change` из статических элементов
- [ ] Использовать `will-change` только для активно анимируемых элементов
- [ ] Удалять `will-change` после завершения анимации
- [ ] Использовать `contain: layout style paint` вместо `will-change` где возможно

#### 2.2 Оптимизация изображений для CLS

- [ ] Все изображения должны иметь `width` и `height` атрибуты
- [ ] Использовать `aspect-ratio` CSS для контейнеров изображений
- [ ] Использовать placeholder'ы с правильными размерами
- [ ] Избегать `object-fit: cover` без фиксированных размеров

#### 2.3 Оптимизация анимаций

- [ ] Использовать только `transform` и `opacity` для анимаций (GPU-ускорение)
- [ ] Избегать анимаций `width`, `height`, `top`, `left` (вызывают reflow)
- [ ] Использовать `transform: translateZ(0)` для создания слоя композиции
- [ ] Отключить анимации на мобильных устройствах с медленным соединением

#### 2.4 Оптимизация шрифтов для CLS

- [ ] Использовать `font-display: optional` (уже есть)
- [ ] Использовать `font-size-adjust` для fallback шрифтов
- [ ] Резервировать место для текста с помощью `min-height`
- [ ] Использовать `line-height` для предотвращения shifts

#### 2.5 Резервирование места для динамического контента

- [ ] Все динамические элементы должны иметь `min-height`
- [ ] Использовать skeleton loaders с правильными размерами
- [ ] Резервировать место для счетчиков и анимаций

### 3. FCP (First Contentful Paint) - 2.6 сек ⚠️

**Проблемы:**

- Слишком много критического CSS
- Шрифты могут блокировать рендеринг
- JavaScript блокирует рендеринг

**Решения:**

#### 3.1 Оптимизация критического CSS

- [ ] Минимизировать критический CSS в `<head>`
- [ ] Убрать неиспользуемый CSS из критического
- [ ] Использовать `media="print"` для некритических стилей
- [ ] Разделить CSS на критические и некритические части

#### 3.2 Оптимизация загрузки шрифтов

- [ ] Preload только критических шрифтов
- [ ] Использовать `font-display: optional` для всех шрифтов
- [ ] Рассмотреть использование системных шрифтов на мобильных

#### 3.3 Оптимизация JavaScript

- [ ] Отложить загрузку некритического JavaScript
- [ ] Использовать `defer` для всех скриптов
- [ ] Минимизировать размер бандла

### 4. Non-composited animations ⚠️

**Проблемы:**

- Обнаружена 1 некомбинированная анимация
- Анимации могут вызывать layout shifts

**Решения:**

#### 4.1 Оптимизация анимаций

- [ ] Проверить все анимации на использование только `transform` и `opacity`
- [ ] Использовать `will-change: transform` только для активно анимируемых элементов
- [ ] Создавать композиционные слои с помощью `transform: translateZ(0)`
- [ ] Отключить анимации на мобильных устройствах с медленным соединением

## Детальный план реализации

### Этап 1: Критическая оптимизация LCP (Приоритет: ВЫСОКИЙ)

1. **Оптимизация изображений**

   ```html
   <!-- Было -->
   <img src="/image.jpg" alt="..." loading="lazy" />

   <!-- Станет -->
   <img
     srcset="/image-400.webp 400w, /image-800.webp 800w, /image-1200.webp 1200w"
     sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
     src="/image-800.webp"
     alt="..."
     width="800"
     height="600"
     loading="lazy"
     decoding="async"
     fetchpriority="low"
   />
   ```

2. **Оптимизация LCP элемента (h1)**
   - Убедиться, что h1 загружается первым
   - Preload критических шрифтов для h1
   - Минимизировать CSS для h1

3. **Отложить GSAP до после LCP**
   - Увеличить таймауты для GSAP на мобильных
   - Использовать `prefers-reduced-motion` для отключения анимаций

### Этап 2: Критическая оптимизация CLS (Приоритет: ВЫСОКИЙ)

1. **Убрать лишние will-change**

   ```css
   /* Было */
   .element {
     will-change: transform, opacity;
   }

   /* Станет - только для активно анимируемых */
   .element.animating {
     will-change: transform;
   }
   .element.animating::after {
     will-change: auto; /* Удаляем после анимации */
   }
   ```

2. **Добавить aspect-ratio для всех изображений**

   ```html
   <div style="aspect-ratio: 16/9; width: 100%;">
     <img
       src="..."
       width="800"
       height="450"
       style="width: 100%; height: 100%; object-fit: cover;"
     />
   </div>
   ```

3. **Оптимизировать анимации**
   - Использовать только `transform` и `opacity`
   - Отключить анимации на медленных соединениях
   - Использовать `prefers-reduced-motion`

### Этап 3: Оптимизация FCP (Приоритет: СРЕДНИЙ)

1. **Минимизировать критический CSS**
   - Убрать неиспользуемые стили
   - Разделить на критические и некритические части

2. **Оптимизировать загрузку шрифтов**
   - Preload только критических
   - Использовать `font-display: optional`

### Этап 4: Оптимизация анимаций (Приоритет: СРЕДНИЙ)

1. **Проверить все анимации**
   - Убедиться, что используются только `transform` и `opacity`
   - Создать композиционные слои

2. **Отключить анимации на медленных соединениях**
   ```javascript
   if ('connection' in navigator) {
     const connection = (navigator as any).connection
     if (connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g')) {
       // Отключить анимации
     }
   }
   ```

## Ожидаемые результаты

После реализации всех оптимизаций:

- **LCP**: 9.8 сек → **< 2.5 сек** ✅
- **CLS**: 0.965 → **< 0.1** ✅
- **FCP**: 2.6 сек → **< 1.8 сек** ✅
- **Performance Score**: 47 → **> 90** ✅

## Приоритеты реализации

1. **Критично (сделать немедленно):**
   - Оптимизация LCP элемента
   - Убрать лишние `will-change`
   - Добавить `aspect-ratio` для изображений
   - Отложить GSAP до после LCP

2. **Важно (сделать в ближайшее время):**
   - Оптимизация изображений (srcset, WebP)
   - Оптимизация анимаций
   - Минимизация критического CSS

3. **Желательно (сделать при возможности):**
   - Отключение анимаций на медленных соединениях
   - Использование системных шрифтов на мобильных
   - Дополнительная оптимизация шрифтов

## Метрики для отслеживания

- LCP (цель: < 2.5 сек)
- CLS (цель: < 0.1)
- FCP (цель: < 1.8 сек)
- TBT (цель: < 200 мс)
- SI (цель: < 3.4 сек)
- Performance Score (цель: > 90)

## Инструменты для проверки

- Lighthouse (Chrome DevTools)
- PageSpeed Insights
- WebPageTest
- Chrome DevTools Performance Panel
- Chrome DevTools Coverage (для неиспользуемого CSS/JS)











